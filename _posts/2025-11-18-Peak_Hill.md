---
layout: post
title: "Peak Hill"
subtitle: "TryHackMe ‚Äì Peak Hill Room"
date: 2025-11-18
author: shivam
tags: [CTF, Binary, Python, Pickle files cybersecurity]
categories: [Walkthrough]
image:
  path: /assets/img/TryHackMe/Peak_Hill/banner.png
---

## ‚ö†Ô∏è DISCLAIMER  
All testing was done inside the authorized TryHackMe environment.  
This write-up is strictly for **educational purposes**.  
Do **NOT** attempt these techniques on systems without permission.  


---

# üîé 1. Reconnaissance  

We begin with a full port scan.

```bash
rustscan -a 10.10.x.x -r 1-65535
```

Open ports:

- **21/tcp ‚Äì FTP (anonymous login enabled)**
- **22/tcp ‚Äì SSH**
- **7321/tcp ‚Äì Custom service requiring credentials**

Follow up with Nmap:

```bash
nmap -sC -sV -p 21,22,7321 10.10.x.x
```


We confirm:

- FTP allows **anonymous login**
- Port **7321** prompts for username/password  
  ‚Üí We do not have valid credentials yet.

---

# üìÅ 2. Enumerating FTP  

Login anonymously:

```bash
ftp 10.10.x.x
Name: Anonymous
Password: (blank)
```

Files available:

- `test.txt`
- `.creds` ‚Üê **Important**

Download both:

```bash
get test.txt
get .creds
```

`.creds` contains a huge binary blob.

![creds_raw](/assets/img/TryHackMe/Peak_Hill/binary.png)

---

# üß† 3. Decoding the `.creds` Binary  

After converting the binary ‚Üí ASCII ‚Üí raw bytes, the result resembles a **Python pickle** structure.


We decode it using Python:

```python
import pickle

with open('download.dat', 'rb') as f:
    data = f.read()
    creds = pickle.loads(data)
    print(creds)
```

Output:

```
[('ssh_pass15','u'),('ssh_user1','h'),('ssh_pass25','r'), ... ]
```

Each tuple contains a **piece of the username or password**.

After sorting & merging, we reconstruct:

![got_pass_ssh](/assets/img/TryHackMe/Peak_Hill/got_pass_ssh.png)

```
Username: gherkin
Password: p1ckl3s_@11_@r0und_th3_w0rld
```

---

# üîê 4. SSH Access  

Login via SSH:

```bash
ssh gherkin@10.10.x.x
```
![ssh](/assets/img/TryHackMe/Peak_Hill/ssh_login.png)
Success.

We now have a **user shell**.

---

# üì¶ 5. User Privilege Escalation ‚Äî Decompiled Python Service  

Inside `/home/gherkin` we find:

```
cmd_service.pyc
```

This is the compiled Python bytecode for the custom service running on **port 7321**.

We decompile it.

The relevant part:

```python
username = long_to_bytes(1684630636)
password = long_to_bytes(2457564920124...)
```

These values decode into:

```python
Username: dill
Password: n3v3r_@_d1ll_m0m3nt
```

---

# üîå 6. Logging Into Port 7321  

Use netcat:

```bash
nc 10.10.x.x 7321
Username: dill
Password: n3v3r_@_d1ll_m0m3nt
```
![login](/assets/img/TryHackMe/Peak_Hill/login.png)
We get a restricted shell that only executes commands.

Read the user flag:

```bash
cat /home/dill/user.txt
```

---

# üß≥ 7. Moving to the `dill` Account via SSH Key  

Extract dill's private key:

```bash
cat /home/dill/.ssh/id_rsa
```

Use it:

```bash
chmod 600 id_rsa
ssh -i id_rsa dill@10.10.x.x
```

Now we are logged in as **dill**.

---

# üîº 8. Root Privilege Escalation  

List sudo rights:

```bash
sudo -l
```

We see:

```
(ALL : ALL) NOPASSWD: /opt/peak_hill_farm/peak_hill_farm
```

This binary is:

- Owned by root  
- Executable by us  
- Has full capabilities via sudo  
- Likely a Python-packaged application


We exploit it by **LD_PRELOAD** / library hijacking / Python module replacement (varies based on examination).

After executing the exploit, we obtain:

```bash
root@ubuntu-xenial:~# id
uid=0(root) gid=0(root)
```

Get the final flag:

```bash
cat /root/root.txt
```
![root_flag](/assets/img/TryHackMe/Peak_Hill/root_flag.png)
---

# üéâ Conclusion  

This box teaches several powerful techniques:

### ‚úî Binary decoding ‚Üí Pickle extraction  
### ‚úî Python pickle exploitation  
### ‚úî Reverse engineering `.pyc` bytecode  
### ‚úî Custom service cracking  
### ‚úî SSH pivoting using stolen private keys  
### ‚úî Rooting via Python module hijacking  

If you enjoy Python-based CTFs, Peak Hill is a great mid-level challenge.

---


